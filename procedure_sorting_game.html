<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ´æ²¹æ©Ÿç¶­è­· - æ­¥é©Ÿæ’åºéŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            width: 100%;
        }
        .step-card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s, background-color 0.2s;
            border-left: 5px solid #3b82f6; /* åˆå§‹è—è‰²é‚Šæ¢ */
        }
        .step-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .step-card.selected {
            border-left: 5px solid #f59e0b; /* é¸ä¸­æ™‚ç‚ºç¥ç€è‰² */
            background-color: #fffbeb;
            box-shadow: 0 6px 12px rgba(234, 179, 8, 0.4);
        }
        .step-card.correct {
            border-left: 5px solid #10b981; /* æ­£ç¢ºæ™‚ç‚ºç¶ è‰² */
            background-color: #f0fff4;
            cursor: default; /* æ­£ç¢ºæ™‚å–æ¶ˆæŒ‡é‡ï¼Œé˜²æ­¢é»æ“Š */
        }
        .order-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e40af;
            width: 40px;
            text-align: center;
            margin-right: 16px;
            flex-shrink: 0;
        }
        .action-text {
            flex-grow: 1;
        }
        .action-text .english {
            font-weight: 600;
            color: #1e3a8a;
        }
        .action-text .chinese {
            font-size: 0.9rem;
            color: #6b7280;
        }
        .check-button {
            transition: all 0.2s;
        }
    </style>
</head>
<body class="p-4">

    <div class="container bg-white p-6 md:p-10 shadow-2xl rounded-xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">âš™ï¸ æŸ´æ²¹æ©Ÿç¶­è­· - æ­¥é©Ÿæ’åºéŠæˆ²</h1>
        <p id="procedure-title" class="text-xl font-semibold text-center text-indigo-600 mb-6">ï¼ˆç¨‹åºæ¨™é¡Œï¼‰</p>
        <p class="text-center text-gray-500 mb-8">é»æ“Šå…©å¼µå¡ç‰‡é€²è¡Œ**äº¤æ›é †åº**ã€‚è«‹å°‡æ­¥é©Ÿæ’åˆ—æˆæ­£ç¢ºçš„ç¨‹åºã€‚</p>

        <div id="steps-container" class="space-y-3">
            <!-- æ­¥é©Ÿå¡ç‰‡å°‡ç”± JavaScript æ³¨å…¥ -->
        </div>

        <div id="message-box" class="mt-8 p-4 text-center rounded-lg font-semibold transition-all duration-300 hidden"></div>
        
        <div class="mt-6 flex justify-center space-x-4">
            <button id="show-answer-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105" onclick="showCorrectOrder()">
                é¡¯ç¤ºæ­£ç¢ºé †åº
            </button>
            <button id="check-button" class="check-button bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105" onclick="checkOrder()">
                æª¢æŸ¥é †åº
            </button>
            <button id="reset-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105" onclick="startGame()">
                é‡æ–°é–‹å§‹ (æ–°é †åº)
            </button>
        </div>
    </div>

    <script>
        // =========================================================================
        // ç¨‹åºæ•¸æ“šåº«ï¼šåŒ…å«ä¸€å€‹æˆ–å¤šå€‹ç¶­è­·ç¨‹åºåŠå…¶æ­¥é©Ÿ
        // order: æ­£ç¢ºçš„æ­¥é©Ÿé †åº (1, 2, 3...)
        // action: è‹±æ–‡æ“ä½œæŒ‡ä»¤
        // chinese: ä¸­æ–‡èªªæ˜
        // =========================================================================
        const PROCEDURE_DATA = [
            {
                title: "ç‡ƒæ²¹å™´æ²¹å™¨æ‹†å¸èˆ‡å®‰è£ç¨‹åº",
                steps: [
                    { order: 1, action: "Shut off the diesel engine.", chinese: "é—œé–‰æŸ´æ²¹æ©Ÿ (Shut off)" },
                    { order: 2, action: "Relieve pressure from fuel system.", chinese: "é‡‹æ”¾ç‡ƒæ²¹ç³»çµ±å£“åŠ› (Relieve)" },
                    { order: 3, action: "Dismount the high-pressure fuel line.", chinese: "æ‹†ä¸‹é«˜å£“ç‡ƒæ²¹ç®¡ (Dismount)" },
                    { order: 4, action: "Remove the injector mounting bolt.", chinese: "ç§»é™¤å™´æ²¹å™¨å›ºå®šèºæ “ (Remove)" },
                    { order: 5, action: "Remove the injector from the cylinder head.", chinese: "æ‹†ä¸‹æ±½ç¼¸è“‹ä¸Šçš„å™´æ²¹å™¨ (Remove)" },
                    { order: 6, action: "Check the new gasket and O-rings.", chinese: "æª¢æŸ¥æ–°çš„å¢Šç‰‡/Oå‹ç’° (Gasket)" },
                    { order: 7, action: "Install the new injector.", chinese: "å®‰è£æ–°çš„å™´æ²¹å™¨" },
                    { order: 8, action: "Tighten the mounting bolt to specification.", chinese: "æŒ‰è¦æ ¼é–ç·Šå›ºå®šèºæ “ (Tightening)" },
                    { order: 9, action: "Install the high-pressure fuel line.", chinese: "å®‰è£é«˜å£“ç‡ƒæ²¹ç®¡" },
                    { order: 10, action: "Bleed the fuel system.", chinese: "æ’å‡ºç‡ƒæ²¹ç³»çµ±ä¸­çš„ç©ºæ°£" }
                ]
            }
            // å¯ä»¥åœ¨æ­¤è™•æ·»åŠ æ›´å¤šç¨‹åºï¼Œä¾‹å¦‚ï¼š
            /*
            {
                title: "èª¿æ•´æ°£é–€é–“éš™ç¨‹åº",
                steps: [
                    { order: 1, action: "..." , chinese: "..." },
                    // ...
                ]
            }
            */
        ];
        // =========================================================================

        let currentProcedure = [];
        let selectedCards = [];
        const stepsContainer = document.getElementById('steps-container');
        const messageBox = document.getElementById('message-box');
        const procedureTitle = document.getElementById('procedure-title');
        const checkButton = document.getElementById('check-button');
        const showAnswerButton = document.getElementById('show-answer-button');

        
        // ç¢ºä¿è‡³å°‘æœ‰ä¸€å€‹ç¨‹åºå¯ä»¥é–‹å§‹éŠæˆ²
        if (PROCEDURE_DATA.length === 0) {
             document.getElementById('steps-container').innerHTML = '<p class="text-center text-red-600 font-bold">éŒ¯èª¤ï¼šPROCEDURE_DATA ä¸­æ²’æœ‰å®šç¾©ä»»ä½•ç¨‹åºæ­¥é©Ÿã€‚</p>';
        }

        // Fisher-Yates Shuffle éš¨æ©Ÿæ‰“äº‚é™£åˆ—
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createSteps(procedure) {
            // è¤‡è£½ä¸¦éš¨æ©Ÿæ‰“äº‚æ­¥é©Ÿ
            const steps = JSON.parse(JSON.stringify(procedure.steps));
            shuffle(steps);
            
            // ç‚ºå¡ç‰‡æ·»åŠ ç•¶å‰ç´¢å¼• (currentOrder)
            steps.forEach((step, index) => {
                step.currentOrder = index + 1;
            });

            currentProcedure = steps;
            procedureTitle.textContent = procedure.title;
        }

        /**
         * æ¸²æŸ“æ­¥é©Ÿå¡ç‰‡
         * @param {boolean} isShowingAnswer - å¦‚æœç‚º trueï¼Œå‰‡ä»¥æ­£ç¢ºé †åºå’Œç¶ è‰²æ¨£å¼æ¸²æŸ“
         */
        function renderSteps(isShowingAnswer = false) {
            stepsContainer.innerHTML = '';
            selectedCards = [];
            
            if (!isShowingAnswer) {
                stepsContainer.classList.remove('pointer-events-none');
                hideMessage();
            }

            currentProcedure.forEach((step, index) => {
                const cardElement = document.createElement('div');
                cardElement.id = `step-card-${index}`;
                
                // Add 'correct' class if we are showing the answer
                cardElement.className = `step-card ${isShowingAnswer ? 'correct' : ''}`;
                
                cardElement.dataset.correctOrder = step.order;
                cardElement.dataset.currentOrder = index + 1;
                
                // åªæœ‰åœ¨ä¸æ˜¯é¡¯ç¤ºç­”æ¡ˆæ¨¡å¼ä¸‹æ‰å…è¨±é»æ“Šæ“ä½œ
                if (!isShowingAnswer) {
                    cardElement.onclick = () => handleCardClick(cardElement, index);
                } else {
                    cardElement.style.cursor = 'default';
                }

                const orderNumber = document.createElement('div');
                orderNumber.className = 'order-number';
                orderNumber.textContent = index + 1; // é¡¯ç¤ºç•¶å‰é †åº
                
                const actionText = document.createElement('div');
                actionText.className = 'action-text';
                actionText.innerHTML = `
                    <div class="english">${step.action}</div>
                    <div class="chinese">${step.chinese}</div>
                `;

                cardElement.appendChild(orderNumber);
                cardElement.appendChild(actionText);
                stepsContainer.appendChild(cardElement);
            });
            
            // ç¢ºä¿æŒ‰éˆ•ç‹€æ…‹èˆ‡éŠæˆ²ç‹€æ…‹åŒæ­¥
            if (!isShowingAnswer) {
                checkButton.disabled = false;
                showAnswerButton.disabled = false;
            }
        }

        function handleCardClick(element, index) {
            if (element.classList.contains('correct')) {
                // å·²ç¢ºèªæ­£ç¢ºçš„å¡ç‰‡ä¸èƒ½å†æ“ä½œ
                return;
            }

            if (selectedCards.includes(index)) {
                // å¦‚æœé»æ“Šå·²ç¶“é¸ä¸­çš„å¡ç‰‡ï¼Œå‰‡å–æ¶ˆé¸ä¸­
                element.classList.remove('selected');
                selectedCards = selectedCards.filter(i => i !== index);
                hideMessage();
                return;
            }

            if (selectedCards.length < 2) {
                element.classList.add('selected');
                selectedCards.push(index);

                if (selectedCards.length === 2) {
                    swapCards();
                } else {
                     showMessage('é»æ“Šç¬¬äºŒå¼µå¡ç‰‡ä¾†äº¤æ›å®ƒå€‘çš„ä½ç½®ã€‚', 'bg-blue-100 text-blue-800');
                }
            }
        }

        function swapCards() {
            const [index1, index2] = selectedCards;
            
            // åœ¨æ•¸æ“šé™£åˆ—ä¸­äº¤æ›ä½ç½®
            [currentProcedure[index1], currentProcedure[index2]] = [currentProcedure[index2], currentProcedure[index1]];

            // æ¸…ç©ºé¸ä¸­ç‹€æ…‹ä¸¦é‡æ–°æ¸²æŸ“
            selectedCards = [];
            renderSteps();
            hideMessage();
        }

        function checkOrder() {
            let correctCount = 0;
            const totalSteps = currentProcedure.length;
            
            // ç§»é™¤æ‰€æœ‰ previous selected å’Œ correct æ¨£å¼
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('selected', 'correct');
            });
            
            // éæ­·ç•¶å‰é †åºï¼Œæª¢æŸ¥æ˜¯å¦èˆ‡æ­£ç¢ºé †åºåŒ¹é…
            currentProcedure.forEach((step, index) => {
                const cardElement = stepsContainer.children[index];
                const currentOrder = index + 1;
                
                if (step.order === currentOrder) {
                    correctCount++;
                    cardElement.classList.add('correct');
                } else {
                    cardElement.classList.remove('correct');
                }
            });

            if (correctCount === totalSteps) {
                showMessage('ğŸ‰ æ­å–œï¼ç¨‹åºé †åºå®Œå…¨æ­£ç¢ºï¼', 'bg-green-100 text-green-800');
                stepsContainer.classList.add('pointer-events-none'); // é–å®šæ“ä½œ
                checkButton.disabled = true;
                showAnswerButton.disabled = true;
            } else {
                showMessage(`ğŸ¤” é‚„æœ‰ ${totalSteps - correctCount} å€‹æ­¥é©Ÿä¸æ­£ç¢ºã€‚ç¶ è‰²å¡ç‰‡å·²ç¢ºèªæ­£ç¢ºï¼`, 'bg-yellow-100 text-yellow-800');
            }
        }
        
        // æ–°å¢åŠŸèƒ½ï¼šé¡¯ç¤ºæ­£ç¢ºé †åº
        function showCorrectOrder() {
            // 1. æ ¹æ“šæ­£ç¢ºçš„é †åºè™Ÿ (step.order) å°æ­¥é©Ÿé™£åˆ—é€²è¡Œæ’åº
            currentProcedure.sort((a, b) => a.order - b.order);

            // 2. ä»¥ã€Œé¡¯ç¤ºç­”æ¡ˆæ¨¡å¼ã€é‡æ–°æ¸²æŸ“æ­¥é©Ÿ
            renderSteps(true); 

            // 3. é¡¯ç¤ºæç¤ºè¨Šæ¯
            showMessage('ğŸ’¡ æ­£ç¢ºé †åºå·²é¡¯ç¤ºã€‚è«‹é»æ“Šã€Œé‡æ–°é–‹å§‹ã€é€²è¡Œä¸‹ä¸€è¼ªç·´ç¿’ã€‚', 'bg-red-100 text-red-800');
            
            // 4. é–å®šæ“ä½œå’Œæª¢æŸ¥æŒ‰éˆ•
            stepsContainer.classList.add('pointer-events-none');
            checkButton.disabled = true;
            showAnswerButton.disabled = true;
        }


        function showMessage(text, className) {
            messageBox.textContent = text;
            messageBox.className = `mt-8 p-4 text-center rounded-lg font-semibold transition-all duration-300 ${className}`;
            messageBox.style.display = 'block';
        }

        function hideMessage() {
            messageBox.style.display = 'none';
        }

        function startGame() {
            if (PROCEDURE_DATA.length === 0) return;
            
            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹ç¨‹åº (å¦‚æœæœ‰å¤šå€‹)
            const randomProcedure = PROCEDURE_DATA[Math.floor(Math.random() * PROCEDURE_DATA.length)];
            
            createSteps(randomProcedure);
            renderSteps(); // Render the shuffled state

            // ç¢ºä¿æŒ‰éˆ•è¢«å•Ÿç”¨
            checkButton.disabled = false;
            showAnswerButton.disabled = false;

            showMessage('è«‹å°‡æ­¥é©Ÿå¡ç‰‡æ‹–æ›³åˆ°æ­£ç¢ºçš„é †åºã€‚', 'bg-blue-100 text-blue-800');
        }

        // é é¢åŠ è¼‰æ™‚å•Ÿå‹•éŠæˆ²
        window.onload = startGame;
        
    </script>
</body>
</html>